# Rollback Raporu (2025-11-06)

Bu doküman, son değişikliklerin geri alınarak sistemin önceki stabil sürüme döndürülmesi sürecinin özetini, uygulanan adımları, testleri ve gözlemleri içerir.

## 1) Son Değişiklikler ve Etkileri
- Kimlik doğrulama akışı `username | userId + password` kombinasyonuna genişletilmişti.
- `src/lib/authOptions.ts` içinde brute-force koruması ve deneme loglaması eklenmişti.
- `src/app/login/page.tsx` login ekranı kullanıcı adı ve kullanıcı ID alanlarıyla güncellenmişti.
- `prisma/schema.prisma` içerisine `LoginAttempt` modeli eklenmişti.

Beklenen etkiler: login esnekliği ve güvenlik logları. Olası yan etkiler: kullanıcı deneyiminde alan karmaşıklığı, Prisma migration ihtiyacı.

## 2) Yedekleme
- Aşağıdaki dosyaların geri alınmadan önceki halleri `rollback_backups/2025-11-06/` klasöründe saklandı:
  - `authOptions.ts.bak`
  - `login_page.tsx.bak`
  - `schema.prisma.bak`

## 3) Önceki Stabil Sürüme Doğrulama
- Login akışı: e‑posta + şifre.
- NextAuth CredentialsProvider: `email`, `password` alanları.
- Rate-limit API mevcut ve UI ile entegre; authOptions içinde rateLimiter yok.

## 4) Adım Adım Geri Alma ve Testler
Uygulanan adımlar:
- `src/lib/authOptions.ts`: e‑posta tabanlı authorize akışına geri dönüldü.
- `src/app/login/page.tsx`: tek alanlı (e‑posta) login UI geri getirildi; rate-limit kontrolü e‑posta ile çalışıyor.
- `prisma/schema.prisma`: `LoginAttempt` modeli kaldırıldı. Prisma şema doğrulama hataları için `Supplier` ters ilişkileri eklendi (yalnızca Prisma şema tutarlılığı; DB yapısını değiştirmez).

Testler:
- Login sayfası açılışı: başarılı.
- E‑posta zorunluluğu ve format doğrulaması: çalışıyor.
- Şifre doğrulama ve hata mesajları: çalışıyor.
- Başarı durumunda yönlendirme: `/`.
- Rate-limit uç noktası: UI üzerinden çağrılabiliyor.

## 5) Performans ve Stabilite Ölçümleri
- Login sayfası yüklenme süresi (yaklaşık): hızlı, hata yok.
- Giriş denemesi yanıt süresi: beklenen seviyede.
- Hata oranı: UI akışında gözlenen hata yok.
- Sunucu port çakışması durumunda otomatik port seçimi: 3001 (Next.js dev sunucu).

## 6) Kullanıcı İletişim Planı (Özet)
- Değişiklik: Login ekranı tekrar e‑posta + şifre formatına döndü.
- Etki: Kullanıcı adı/ID alanları kaldırıldı; eski davranış geri geldi.
- Aksiyon: Kullanıcılara kısa bir duyuru ve SSS; destek kanalı yönlendirmesi.

## 7) Notlar ve İzleyen İşler
- Prisma generate sırasında Windows dosya kilidi nedeniyle hata gözlemlendi (`EPERM ... rename`). Geliştirme makinesinde antivirüs/dev sunucu kilidi kaynaklı olabilir; tekrar deneme veya geçici klasörü temizleme önerilir.
- DB migration `remove_login_attempts` uygulanması için `prisma migrate dev` komutu tekrar çalıştırılabilir (CI/CD veya lokal).

---
Bu geri alma ile sistem, önceki stabil login davranışına dönmüştür. UI ve akış testleri başarıyla tamamlanmıştır.